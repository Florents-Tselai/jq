#########################################################################################################
#                                      HTTP
#########################################################################################################

http("POST"; "https://httpbin.org/anything"; [["Content-Type", "application/json"]]; "application/json") | .json
{"k1": "v1", "k2": "v2"}
{"k1":"v1","k2":"v2"}

http("POST"; "https://httpbin.org/anything"; [["Content-Type", "application/json"]]; "application/json") | .json
["a", "b", "c"]
["a", "b", "c"]

http("GET"; "https://httpbin.org/anything"; [["Content-Type", "application/json"]]; "application/json") | .method
"ignored"
"GET"

http_get | .url
"https://httpbin.org/anything"
"https://httpbin.org/anything"

http_post("https://httpbin.org/anything") | .json
"Hello World!"
"Hello World!"

#########################################################################################################
#                                      Ollama Generate
#########################################################################################################

#### Generate

__ollama_make_generate_payload("llama3.2")
"Why is the sky blue?"
{ "model": "llama3.2", "prompt": "Why is the sky blue?", "stream": false }


__ollama_make_generate_payload("llama3.2") | http_post("http://localhost:11434/api/generate") | {model, done, done_reason}
"Tell me a story"
{ "model": "llama3.2", "done": true, "done_reason": "stop" }


#### Embed one
__ollama_make_embed_payload("all-minilm")
"Why is the sky blue?"
{ "model": "all-minilm", "input": ["Why is the sky blue?"] }

### Embed multi
__ollama_make_embed_payload("all-minilm")
["Why is the sky blue?", "Why is the grass green?"]
{ "model": "all-minilm", "input": ["Why is the sky blue?", "Why is the grass green?"] }

#########################################################################################################
#                                      Vector Operations
#########################################################################################################

vector
[1,2,3]
[1,2,3]

vector | ndims
[1,2,3]
3

[1,2,3,4] | l2_norm
null
5.477225575051661

[1,2,3,4] | l2_distance([1,3,5,40])
null
36.069377593742864

[1,2,3,4] | l2_distance([11,22,33,43])
null
54.04627646748664

[1,2,3,4] | dot_product([1,3,5,40])
null
182

[1,2,3,4] | cosine_similarity([1,3,5,40])
null
0.8217730265940303

# knn-search exact
# `candidates | knn_search(v, k=1)`
knn_search([1,2,3,4]; 1)
[[1,2,3,4], [1,22,33,14], [12,23,34,45], [28,36,31,44]]
[[1,2,3,4]]