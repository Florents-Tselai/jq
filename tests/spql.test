#########################################################################################################
#                                      HTTP
#########################################################################################################

http_get | .url
"https://httpbin.org/anything"
"https://httpbin.org/anything"

{"k1": "v1", "k2": "v2"} | http_post("https://httpbin.org/anything"; {"h1": "v1", "h2": "v2"}) | .json
null
{"k1": "v1", "k2": "v2"}

#########################################################################################################
#                                      Vectors
#########################################################################################################

vector
[1,2,3]
[1,2,3]

vector | ndims
[1,2,3]
3

[1,2,3,4] | l2_norm
null
5.477225575051661

[1,2,3,4] | l2_distance([1,3,5,40])
null
36.069377593742864

[1,2,3,4] | l2_distance([11,22,33,43])
null
54.04627646748664

[1,2,3,4] | dot_product([1,3,5,40])
null
182

[1,2,3,4] | cosine_similarity([1,3,5,40])
null
0.8217730265940303

# knn-search exact
# `candidates | knn_search(v, k=1)`
knn_search([1,2,3,4]; 1)
[[1,2,3,4], [1,22,33,14], [12,23,34,45], [28,36,31,44]]
[[1,2,3,4]]

#########################################################################################################
#                                      Python Basics
#########################################################################################################

pyupper
"hello"
"HELLO"

#########################################################################################################
#                                      tokenize: HF Transformers
#########################################################################################################


tokenize("hf-internal-testing/tiny-random-gpt2") | vector | ndims
"hello there"
4

tokenize("hf-internal-testing/tiny-random-gpt2") | vector | ndims
"the cat is still on the tree. waaaat? Άντε γειά!"
37

tokenize| vector | ndims
"the cat is still on the tree. waaaat? Άντε γειά!"
37

#########################################################################################################
#                                      embed: HF Transformers
#########################################################################################################

# It looks like jq doesn't like too big arrays in expected output, hence we validate for ndims.

embed("hf-internal-testing/tiny-random-gpt2") | vector | ndims
"Hello"
32

embed("hf-internal-testing/tiny-random-gpt2") | vector | ndims
"Lorem Ipsum"
32

embed | vector | ndims
"Lorem Ipsum"
32

#########################################################################################################
#                                      prompt: llama2c
#########################################################################################################

[.[] | prompt("llam2c") | startswith("hello world")]
["hello world"]
[true]

# no model provided / pick default
[.[] | prompt | startswith("hello world")]
["hello world"]
[true]

#########################################################################################################
#                                      env vars
#########################################################################################################


# llm_getconfig

llm_getconfig | .env.JQLLM_TESTVAR1
null
"value1"


#########################################################################################################
#                                       model creation
#########################################################################################################
# Arguments passed to llm_model are passed to user-facing functions
# like generate, embed etc.
#

# llm_model
#llm_model("stories15M.bin").path == env.PWD + "/tests/models/stories15M.bin"
#null
#true

#llm_model("stories15M.bin").name == "stories15M"
#null
#true

# Params: note that steps is set by the user and the rest are defaults
llm_model("stories15M.bin"; {"steps": 200}).params
null
{ "temperature": 1, "topp": 0.9, "steps": 200, "rng_seed": 0}
